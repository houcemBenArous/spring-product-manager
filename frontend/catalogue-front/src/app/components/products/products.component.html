<div class="container mt-4">
  <div class="card">
    <!-- Card Header -->
    <div class="card-header d-flex justify-content-between align-items-center">
      <h3>Liste des Produits</h3>
      <button class="btn btn-primary" (click)="ajouterNouveauProduit()">
        Ajouter un produit
      </button>
    </div>

    <!-- Card Body -->
    <div class="card-body">

      <!-- Filters Section -->
      <div class="row mb-3">
        <!-- Search by Name -->
        <div class="col-md-6">
          <input
            type="text"
            class="form-control"
            placeholder="Rechercher par nom..."
            [(ngModel)]="searchNom"
            (input)="onSearchChange()"
          >
        </div>

        <!-- Filter by Category -->
        <div class="col-md-6">
          <select
            class="form-select"
            [(ngModel)]="selectedCategorie"
            (change)="onCategorieChange()"
          >
            <option value="">Toutes les catégories</option>
            <option *ngFor="let cat of categories" [value]="cat.id">
              {{ cat.nom }}
            </option>
          </select>
        </div>
      </div>

      <!-- Products Table -->
      <table class="table table-striped table-bordered">
        <thead class="thead-dark">
        <tr>
          <th>ID</th>
          <th>Image</th>
          <th>Nom</th>
          <th>Prix</th>
          <th>Quantité</th>
          <th>Catégorie</th>
          <th>Actions</th>
        </tr>
        </thead>
        <tbody>
        <tr *ngFor="let p of produits">
          <td>{{ p.id }}</td>
          <td>
            <img 
              *ngIf="getProductImageUrl(p)" 
              [src]="getProductImageUrl(p)" 
              alt="{{ p.nom }}"
              class="img-thumbnail"
              style="width: 50px; height: 50px; object-fit: cover;"
              (error)="onImageError($event)"
            >
            <span *ngIf="!getProductImageUrl(p)" class="text-muted small">
              <i class="fas fa-image"></i> Aucune image
            </span>
          </td>
          <td>{{ p.nom }}</td>
          <td>{{ p.prix | currency:'EUR' }}</td>
          <td>{{ p.quantite }}</td>
          <td>{{ p.categorie?.nom }}</td>
          <td>
            <button
              class="btn btn-danger btn-sm"
              (click)="supprimer(p)"
            >
              Supprimer
            </button>
          </td>
        </tr>
        </tbody>
      </table>

    </div>
  </div>
</div>
